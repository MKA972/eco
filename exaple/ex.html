<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EcoPath | Waste Dashboard</title>

<!-- Fonts & Libraries -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg:#f3f6f5;--text:#00221c;--secondary:#44524f;
  --primary:#006e55;--primary-light:#00a676;--accent:#f79c29;
  --card:#fff;--border:#d0d8d6;--shadow:rgba(0,0,0,0.12);
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Poppins;background:var(--bg);color:var(--text)}

/* NAVBAR */
header{
  position:fixed;top:0;width:100%;z-index:100;
  background:var(--card);padding:.9rem 7%;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 2px 8px var(--shadow);backdrop-filter:blur(10px);
}

.logo{font-size:1.5rem;font-weight:700;color:var(--primary);letter-spacing:.5px;}

nav ul{display:flex;align-items:center;gap:1.4rem;list-style:none}
nav a{
  text-decoration:none;color:var(--text);padding:.45rem .9rem;
  font-weight:500;border-radius:25px;transition:.3s;
}
nav a:hover,nav a.active{background:var(--primary);color:#fff}

nav .badge{
  background:red;color:white;font-size:.7rem;
  padding:2px 6px;border-radius:50%;margin-left:3px;
}

select{
  background:var(--primary);color:#fff;border:none;
  padding:.45rem .9rem;border-radius:25px;cursor:pointer;font-weight:600;
}

/* HERO */
.hero{text-align:center;padding:7rem 1rem 3rem}
.hero h1{font-size:2.3rem;color:var(--primary);margin-bottom:.3rem}

/* DASHBOARD */
.dashboard{padding:2rem 7%}

.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-bottom:2rem}
.kpi{
  background:var(--card);padding:1.2rem;border-radius:14px;
  box-shadow:0 4px 12px var(--shadow);text-align:center;
}
.kpi h4{color:var(--primary-light);font-size:.95rem}
.kpi p{font-size:1.3rem;font-weight:600;margin-top:.2rem}

/* CHART LAYOUT */
.chart-area{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:1.8rem}
.chart-box{
  background:var(--card);padding:1.2rem;
  border-radius:14px;box-shadow:0 4px 12px var(--shadow);
}
h3{margin-bottom:.6rem;font-size:1.1rem}

/* MAP */
#leafletMap{height:420px;border-radius:12px;margin-top:1rem;box-shadow:0 4px 12px var(--shadow);margin-bottom:2rem}

/* TABLE for Requests */
table{width:100%;border-collapse:collapse;margin-top:1rem;background:white;border-radius:12px;overflow:hidden;box-shadow:0 3px 8px var(--shadow)}
th{background:var(--primary);color:white;padding:.8rem}
td{padding:.8rem;border-bottom:1px solid var(--border)}
button{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;font-weight:600}
.accept{background:var(--primary-light);color:#fff}
.reschedule{background:var(--accent);color:#fff}
.done{background:#008f39;color:#fff}

/* FOOTER */
footer{
  background:var(--card);padding:3rem 7%;
  border-top:1px solid var(--border);margin-top:2rem;
}
footer h2{color:var(--primary)}
footer a{color:var(--secondary);text-decoration:none;display:block;margin-bottom:4px}
</style>
</head>
<body>

<header>
  <div class="logo">EcoPath ðŸŒ±</div>
  <nav>
    <ul>
      <li><a href="#charts" class="active">Dashboard</a></li>
      <li><a href="#map">Map</a></li>
      <li><a href="#requests">Requests<span id="requestBadge" class="badge">0</span></a></li>
      <li>
        <select id="citySelect">
          <option>Seoul</option><option>Busan</option><option>Daegu</option>
        </select>
      </li>
    </ul>
  </nav>
</header>

<section class="hero">
  <h1>Municipal Waste Intelligence</h1>
  <p>Monitor trash output, trends & recycling behavior by district.</p>
</section>

<section class="dashboard" id="charts">
<h2 style="margin-bottom:1rem;">City: <span id="cityName">Seoul</span></h2>

<div class="kpi-grid">
  <div class="kpi"><h4>Average / District</h4><p id="kpiAvg">...</p></div>
  <div class="kpi"><h4>Top District</h4><p id="kpiTopDistrict">...</p></div>
  <div class="kpi"><h4>Recycle Rate</h4><p id="kpiRecycle">...</p></div>
</div>

<div class="chart-area">
  <div class="chart-box">
    <h3>Waste by District (kg/day)</h3>
    <canvas id="barChart"></canvas>
  </div>
  <div class="chart-box">
    <h3>Weekly Waste Trend</h3>
    <canvas id="lineChart"></canvas>
  </div>
  <div class="chart-box">
    <h3>Waste Composition</h3>
    <canvas id="pieChart"></canvas>
  </div>
</div>
</section>

<section class="dashboard" id="map">
<h2>City Waste Density</h2>
<div id="leafletMap"></div>
<section class="dashboard" id="requests">
<h2>Pick-up Requests</h2>
<table id="requestTable"><thead><tr><th>Location</th><th>Date</th><th>Pic</th><th>Actions</th></tr></thead><tbody></tbody></table>

<h2 style="margin-top:2rem">Scheduled</h2>
<table id="scheduledTable"><thead><tr><th>Location</th><th>Date</th><th>Actions</th></tr></thead><tbody></tbody></table>

</section>

</section>

<footer>
<div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:2rem">
  <div>
    <h2>EcoPath ðŸŒ±</h2>
    <p>Smart waste monitoring for sustainable cities.</p>
    <div style="display:flex;gap:10px;margin-top:8px">
      <a href="https://play.google.com"><img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" style="height:40px"></a>
      <a href="https://apps.apple.com"><img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" style="height:40px"></a>
    </div>
  </div>
  <div>
    <h4>Menu</h4>
    <a href="#charts">Dashboard</a>
    <a href="#map">Map</a>
    <a href="#requests">Requests</a>
  </div>
  <div>
    <h4>Contact</h4>
    <p>support@ecopath.org</p>
    <p>+82 10-1234-5678</p>
    <p>Seoul, Korea</p>
  </div>
</div>
<p style="text-align:center;margin-top:2rem;color:#567;">Â© 2025 EcoPath</p>
</footer>

<script>
/* Trash mock data */
const trashData = {
"Seoul":[
{district:"Gangnam",total:12000,plastic:4000,food:5000,glass:1500,metal:1500,weekly:[1800,1700,1650,1900,2100,1850,2000],lat:37.5172,lon:127.0473},
{district:"Jongno",total:8000,plastic:2500,food:3500,glass:1000,metal:1000,weekly:[1200,1100,1150,1300,1400,1350,1500],lat:37.5729,lon:126.9793},
{district:"Gwangjin",total:15000,plastic:4500,food:7000,glass:2000,metal:1500,weekly:[2000,2100,2050,2250,2500,2400,2700],lat:37.5386,lon:127.0826}
],
"Busan":[
{district:"Haeundae",total:9000,plastic:3000,food:4000,glass:1000,metal:1000,weekly:[1300,1250,1350,1500,1600,1550,1750],lat:35.1632,lon:129.1636},
{district:"Suyeong",total:12000,plastic:3500,food:5500,glass:1500,metal:1500,weekly:[1600,1550,1650,1800,1900,1850,2100],lat:35.1425,lon:129.1139}
],
"Daegu":[
{district:"Dalseo",total:9500,plastic:3000,food:4000,glass:1200,metal:1300,weekly:[1400,1450,1500,1700,1650,1750,1800],lat:35.8296,lon:128.5329}
]
};

/* Global chart refs */
let barChart,lineChart,pieChart;

function renderDashboard(city){
const data = trashData[city];
document.getElementById("cityName").textContent=city;

/* KPI */
const totals = data.map(d=>d.total);
const avg = Math.round(totals.reduce((a,b)=>a+b,0)/data.length);
const top = data.sort((a,b)=>b.total-a.total)[0].district;
const sumPlastic = data.reduce((a,b)=>a+b.plastic,0);
const sumGlass = data.reduce((a,b)=>a+b.glass,0);
const sumMetal = data.reduce((a,b)=>a+b.metal,0);
const sumFood = data.reduce((a,b)=>a+b.food,0);

kpiAvg.textContent = avg+" kg/day";
kpiTopDistrict.textContent = top;
kpiRecycle.textContent = Math.round((sumPlastic+sumGlass+sumMetal)/(sumPlastic+sumGlass+sumMetal+sumFood)*100)+"%";

/* Bar chart */
barChart?.destroy();
barChart = new Chart(barChart,{type:"bar",
data:{labels:data.map(d=>d.district),datasets:[{data:totals,backgroundColor:"#00a676"}]},
options:{plugins:{legend:{display:false}}}});

/* Line trend */
const weekly=[0,1,2,3,4,5,6].map(i=>data.map(d=>d.weekly[i]).reduce((a,b)=>a+b,0));
lineChart?.destroy();
lineChart = new Chart(lineChart,{type:"line",
data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{data:weekly,borderColor:"#006e55",borderWidth:3,tension:.4}]},
options:{plugins:{legend:{display:false}}}});

/* Pie composition */
pieChart?.destroy();
pieChart = new Chart(pieChart,{type:"pie",
data:{labels:["Plastic","Food","Glass","Metal"],datasets:[{data:[sumPlastic,sumFood,sumGlass,sumMetal],
backgroundColor:["#00a676","#8bc34a","#cddc39","#ff9800"]}]}
});
}

/* Map */
const map=L.map("leafletMap").setView([37.5665,126.9780],11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let markers=[];
function updateMap(city){
markers.forEach(m=>m.remove());markers=[];
trashData[city].forEach(p=>{
const color=p.total>12000?"red":p.total>9000?"yellow":"green";
const m=L.circleMarker([p.lat,p.lon],{radius:10,color,fillOpacity:.85})
.addTo(map).bindPopup(`<b>${p.district}</b><br>${p.total} kg/day`);
markers.push(m);
});
map.setView([trashData[city][0].lat,trashData[city][0].lon],11);
}

/* Requests system */
let requests=[
{location:"Seoul",datetime:"2025-11-01 10:00",pic:"https://via.placeholder.com/50"},
{location:"Busan",datetime:"2025-11-02 14:00",pic:"https://via.placeholder.com/50"}
];
let scheduled=[];

function renderRequests(){
requestBadge.textContent=requests.length;
requestTable.querySelector("tbody").innerHTML=requests.map((r,i)=>`
<tr>
<td>${r.location}</td><td>${r.datetime}</td><td><img src="${r.pic}" width="42"></td>
<td><button class="accept" onclick="acc(${i})">   Accept</button>
<button class="reschedule" onclick="res(${i})">   Reschedule</button></td></tr>`).join("");
}
function acc(i){scheduled.push(requests[i]);requests.splice(i,1);renderRequests();renderScheduled();}
function res(i){const d=prompt("New date:",requests[i].datetime);if(d){requests[i].datetime=d;renderRequests();}}
function renderScheduled(){
scheduledTable.querySelector("tbody").innerHTML=scheduled.map((r,i)=>`
<tr><td>${r.location}</td><td>${r.datetime}</td>
<td><button class="done" onclick="fin(${i})">Done</button></td></tr>`).join("");
}
function fin(i){scheduled.splice(i,1);renderScheduled();}

/* Init */
citySelect.onchange=e=>{renderDashboard(e.target.value);updateMap(e.target.value)};
renderDashboard("Seoul");updateMap("Seoul");renderRequests();renderScheduled();
</script>

</body>
</html>
