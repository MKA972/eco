<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EcoPath Energy & Gas Dashboard</title>

<!-- Fonts & Libraries -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>

<style>
/* ========= LIGHT THEME ========= */
:root {
  --bg: #f3f6f5;
  --text-main: #00221c;
  --text-secondary: #44524f;
  --primary: #006e55;
  --primary-light: #00a676;
  --accent-amber: #f79c29;
  --card-bg: #ffffff;
  --border: #d0d8d6;
  --shadow: rgba(0, 0, 0, 0.1);
}

/* ========= DARK THEME ========= */
[data-theme="dark"] {
  --bg: #0e141a;
  --text-main: #f1f3f2;
  --text-secondary: #a9b5b3;
  --primary: #00c48c;
  --primary-light: #00ffb0;
  --accent-amber: #ffb703;
  --card-bg: #121c25;
  --border: #22313b;
  --shadow: rgba(0, 0, 0, 0.6);
}

/* ========= GLOBAL ========= */
*{margin:0;padding:0;box-sizing:border-box;transition:background .3s,color .3s,border .3s;}
body{font-family:"Poppins",sans-serif;background:var(--bg);color:var(--text-main);overflow-x:hidden;line-height:1.6;}

/* HEADER */
header{background:var(--card-bg);position:fixed;top:0;width:100%;padding:1rem 8%;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px var(--shadow);z-index:100;}
.LOGO{font-weight:700;font-size:1.6rem;color:var(--primary);text-decoration:none;}
nav a{color:var(--text-main);text-decoration:none;margin:0 1rem;font-weight:500;}
nav a:hover,nav a.active{color:var(--primary-light);}
select{background:var(--primary);color:#fff;border:none;padding:8px 14px;border-radius:8px;font-weight:600;cursor:pointer;}

/* SWITCH */
.switch {font-size:17px;position:relative;display:inline-block;width:3.5em;height:2em;margin-left:1rem;}
.switch input{opacity:0;width:0;height:0;}
.slider{--background:#b8b6b6;position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--background);transition:.5s;border-radius:25px;}
.slider:before{position:absolute;content:"";height:1.4em;width:1.4em;border-radius:50%;left:10%;bottom:15%;box-shadow: inset 8px -4px 0px 0px #fff000;background:var(--background);transition:.5s;}
input:checked + .slider{background-color:#1a6249;}
input:checked + .slider:before{transform:translateX(100%);box-shadow: inset 15px -4px 0px 15px #fff000;}

/* HERO */
.hero{text-align:center;padding:8rem 1rem 4rem;background:linear-gradient(180deg,var(--bg)0%,var(--card-bg)100%);}
.hero h1{font-size:2.6rem;font-weight:700;color:var(--primary);margin-bottom:1rem;}
.hero p{max-width:700px;margin:auto;color:var(--text-secondary);font-size:1.1rem;}

/* DASHBOARD */
.dashboard{padding:4rem 8%;}
#chartTitle{text-align:center;font-size:1.9rem;font-weight:600;margin-bottom:2rem;color:var(--text-main);}

/* KPI ROW */
.kpi-row{display:flex;flex-wrap:wrap;gap:1.5rem;justify-content:center;margin-bottom:3rem;}
.kpi-card{background:var(--card-bg);border-radius:12px;padding:1.2rem 2rem;min-width:220px;text-align:center;box-shadow:0 6px 14px var(--shadow);}
.kpi-card h4{color:var(--primary-light);margin-bottom:.4rem;}
.kpi-card p{font-size:1.2rem;font-weight:600;color:var(--text-main);}

/* CHARTS */
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:2rem;margin-bottom:2rem;}
.chart-card{background:var(--card-bg);border-radius:14px;box-shadow:0 4px 12px var(--shadow);padding:1.5rem;}
.chart-card h3{color:var(--text-main);margin-bottom:1rem;font-weight:600;}
.chart-card canvas{width:100%;height:300px!important;}
.chart-wide{width:95%;margin:0 auto;margin-top:30px;}

/* MAP */
#map{height:70vh;width:90%;margin:3rem auto;border-radius:14px;box-shadow:0 6px 20px var(--shadow);border:2px solid var(--border);}
.map-controls{display:flex;justify-content:center;gap:1.2rem;flex-wrap:wrap;margin:1rem auto;color:var(--text-main);font-weight:500;}
.map-controls input[type="radio"]{accent-color:var(--primary-light);}


/* ================= FOOTER ================= */
.eco-footer {
  background: var(--card-bg);
  border-top: 2px solid var(--border);
  padding: 40px 8%;
  margin-top: 60px;
  color: var(--text-main);
}

.footer-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 40px;
}

/* Footer Sections */
.footer-section h3 {
  margin-bottom: 10px;
  font-size: 1.1rem;
  color: var(--primary);
}

.footer-section a,
.footer-section p {
  display: block;
  color: var(--text-main);
  margin-bottom: 8px;
  text-decoration: none;
  font-size: 0.9rem;
}

.footer-section a:hover {
  color: var(--primary-light);
}

.footer-logo {
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--primary);
}

/* Official Store Buttons */
.footer-apps-real {
  margin-top: 18px;
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
  align-items: center;
}

.store-badge-img {
  height: 48px;
  transition: .25s ease;
  cursor: pointer;
}

.store-badge-img:hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}

/* Social icons */
.footer-social a {
  display: inline-block;
  font-size: 1.3rem;
  margin-right: 10px;
  color: var(--text-main);
}

.footer-social a:hover {
  color: var(--primary-light);
}

.footer-bottom {
  text-align: center;
  margin-top: 25px;
  font-size: 0.85rem;
  opacity: 0.7;
}



</style>
</head>
<body>

<header>
  <a href="#" class="LOGO">EcoPath üå±</a>
  <nav>
    <a href="#charts">Dashboard</a>
    <a href="#map">Map</a>
    <a href="#contact">Contact</a>
    <a href="./gas.html">Waste</a>
  <select id="citySelect">
      <option>Seoul</option>
      <option>Busan</option>
      <option>Daegu</option>
      <option>Daejeon</option>
      <option>Gyeonggi</option>
      <option>Gangwon</option>
      <option>Jeju</option>
    </select>
  </nav>
  <label class="switch">
    <input type="checkbox" id="themeSwitch">
    <span class="slider"></span>
  </label>
</header>

<section class="hero">
  <h1>EcoPath Energy & Gas Dashboard</h1>
  <p>Compare city-level energy consumption to drive sustainable policies.</p>
</section>

<section class="dashboard" id="charts">
  <h2 id="chartTitle">Energy Overview (<span id="energyCityLabel">Seoul</span>)</h2>

  <div class="kpi-row">
    <div class="kpi-card"><h4>Total Energy</h4><p id="totalEnergy">Loading...</p></div>
    <div class="kpi-card"><h4>Average Usage</h4><p id="avgEnergy">Loading...</p></div>
    <div class="kpi-card"><h4>Top District</h4><p id="topEnergyDistrict">Loading...</p></div>
  </div>

  <div class="card-grid">
    <div class="chart-card"><h3>Electricity Usage (kWh)</h3><canvas id="elecChart"></canvas></div>
    <div class="chart-card"><h3>Gas Usage (m¬≥)</h3><canvas id="gasChart"></canvas></div>
  </div>

  <!-- ‚úÖ Wider Line Chart Below -->
  <div class="chart-card chart-wide">
    <h3 style="text-align:center;">Energy vs Gas Comparison (Cities)</h3>
    <canvas id="lineCompareChart" style="height:380px!important;"></canvas>
  </div>
</section>

<h2 style="text-align:center;margin-top:60px;">üåç Nationwide Energy Map</h2>
<div class="map-controls">
  <label><input type="radio" name="energy" value="Electricity" checked> Electricity</label>
  <label><input type="radio" name="energy" value="Gas"> Gas</label>
</div>
<div id="map"></div>

<footer class="eco-footer">
  <div class="footer-container">

    <!-- Logo + tagline -->
    <div class="footer-section">
      <h2 class="footer-logo">EcoPath üå±</h2>
      <p>Empowering sustainable cities through smart waste & energy analytics.</p>

      <!-- Official app download badges -->
      <div class="footer-apps-real">
        <a href="https://apps.apple.com" target="_blank">
          <img class="store-badge-img" 
            src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg"
            alt="Download on the App Store">
        </a>
        <a href="https://play.google.com" target="_blank">
          <img class="store-badge-img"
            src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg"
            alt="Get it on Google Play">
        </a>
      </div>
    </div>

    <!-- Navigation -->
    <div class="footer-section">
      <h3>Navigation</h3>
      <a href="index.html">Home</a>
      <a href="energy.html">Energy & Gas</a>
      <a href="gas.html">Waste</a>
      <a href="login.html">Admin Login</a>
    </div>

    <!-- Contact -->
    <div class="footer-section" id="contact">
      <h3>Contact</h3>
      <p>üìû +82 10-0000-0000</p>
      <p>‚úâÔ∏è support@ecopath.com</p>
      <p>üåç Seoul, South Korea</p>

      <!-- Social icons -->
      <div class="footer-social">
        <a href="#" target="_blank"></a>
        <a href="#" target="_blank"></a>
        <a href="#" target="_blank"></a>
      </div>
    </div>

  </div>

  <p class="footer-bottom">
    ¬© 2025 EcoPath. All rights reserved.
  </p>
</footer>

<script>
/* ========= API AUTO MODE ========= */
const API_BASE = window.location.hostname.includes("localhost")
  ? "http://localhost:8000"   // ‚úÖ Local dev
  : "https://YOUR_BACKEND_DOMAIN.com"; // ‚úÖ Deploy backend URL here

console.log("API connected to:", API_BASE);

/* ========= THEME SWITCH ========= */
const toggle = document.getElementById("themeSwitch");
toggle.addEventListener("change", () => {
  document.documentElement.setAttribute("data-theme", toggle.checked ? "dark" : "light");
});

let elecChart, gasChart, lineCompareChart;
const citySelect = document.getElementById("citySelect");
const chartTitle = document.getElementById("chartTitle");
const energyCityLabel = document.getElementById("energyCityLabel");

/* ========= GENERATE DAILY MOCK DATA ========= */
function generateDailyMock(baseKwh, baseM3) {
  const days = Array.from({ length: 30 }, (_, i) => `Day ${i + 1}`);
  const elec = days.map(() => Math.round(baseKwh * (0.85 + Math.random() * 0.3)));
  const gas  = days.map(() => Math.round(baseM3 * (0.85 + Math.random() * 0.3)));
  return { days, elec, gas };
}

/* ========= BASE MOCK VALUES ========= */
const baseMock = {
  "Seoul":   { kwh: 310, m3: 45 },
  "Busan":   { kwh: 280, m3: 40 },
  "Daegu":   { kwh: 260, m3: 38 },
  "Daejeon": { kwh: 240, m3: 35 },
  "Gyeonggi":{ kwh: 320, m3: 48 },
  "Gangwon": { kwh: 200, m3: 30 },
  "Jeju":    { kwh: 230, m3: 33 }
};

/* ========= RENDER CHARTS ========= */
function renderCharts(days, elec, gas) {
  if (elecChart) elecChart.destroy();
  if (gasChart) gasChart.destroy();
  if (lineCompareChart) lineCompareChart.destroy();

  document.getElementById("lineCompareChart").style.display = "block";

  elecChart = new Chart(document.getElementById("elecChart"), {
    type:"bar",
    data:{ labels: days, datasets:[{ label:"Electricity (kWh)", data:elec, backgroundColor:"#00a676" }] },
    options:{ plugins:{ legend:{ display:false } }, scales:{ x:{ ticks:{ maxRotation:90,minRotation:90 } } } }
  });

  gasChart = new Chart(document.getElementById("gasChart"), {
    type:"bar",
    data:{ labels: days, datasets:[{ label:"Gas (m¬≥)", data:gas, backgroundColor:"#f79c29" }] },
    options:{ plugins:{ legend:{ display:false } }, scales:{ x:{ ticks:{ maxRotation:90,minRotation:90 } } } }
  });

  lineCompareChart = new Chart(document.getElementById("lineCompareChart"), {
    type: "line",
    data: {
      labels: days,
      datasets: [
        { label: "Electricity (kWh)", data: elec, borderColor: "#00a676", borderWidth: 2, tension: 0.3 },
        { label: "Gas (m¬≥)", data: gas, borderColor: "#f79c29", borderWidth: 2, tension: 0.3 }
      ]
    }
  });

  const total = elec.reduce((a,b)=>a+b,0);
  const avg = Math.round(total / elec.length);
  document.getElementById("totalEnergy").textContent = total + " kWh";
  document.getElementById("avgEnergy").textContent = avg + " kWh";
  document.getElementById("topEnergyDistrict").textContent = energyCityLabel.textContent;
}

/* ========= LOAD DATA ========= */
async function loadData(city) {
  energyCityLabel.textContent = city;
  chartTitle.textContent = `${city} ‚Äî Monthly (Daily View)`;

  const { kwh: baseKwh, m3: baseM3 } = baseMock[city];
  const smartMeterId = "714aa86b-55ae-448e-9220-4d3c205e9a06";

  try {
    const url = `${API_BASE}/api/smart-meters/${smartMeterId}/readings`;
    const res = await fetch(url);
    const json = await res.json();

    if (!json.data || json.data.length === 0) {
      const mock = generateDailyMock(baseKwh, baseM3);
      chartTitle.textContent = `${city} ‚Äî Mock Daily Data`;
      renderCharts(mock.days, mock.elec, mock.gas);
      return;
    }

    const latest = json.data[json.data.length - 1];
    const mock = generateDailyMock(latest.kwh, latest.m3);
    chartTitle.textContent = `${city} ‚Äî Live API (Daily Projection)`;
    renderCharts(mock.days, mock.elec, mock.gas);

  } catch (err) {
    console.error(err);
    const mock = generateDailyMock(baseKwh, baseM3);
    chartTitle.innerHTML = `${city} ‚Äî <span style='color:red;'>API Error (Mock Data)</span>`;
    renderCharts(mock.days, mock.elec, mock.gas);
  }
}

/* ========= MAP ========= */
const map = L.map("map").setView([36.5,127.9], 7);
L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", { maxZoom:18 }).addTo(map);
L.circleMarker([37.5665,126.9780], { radius:10, color:"#00a676" }).bindPopup("Seoul").addTo(map);

/* ========= INIT ========= */
citySelect.addEventListener("change", e => loadData(e.target.value));
loadData("Seoul");
</script>
</body>
</html>
